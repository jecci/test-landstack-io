"use strict";
var $next3SetUp={content_wrap:".next3offload-body",save_form:"form.next3offload-settings",init:function(){$next3SetUp.actionRadioProviders(".next3offload-provider");var e=document.querySelector($next3SetUp.save_form);e&&(e.removeEventListener("submit",$next3SetUp.saveConfig),e.addEventListener("submit",$next3SetUp.saveConfig));let t=document.querySelector("button.nx3_exiting_bucket_btn");t&&(t.removeEventListener("click",$next3SetUp.exitingBucketSave),t.addEventListener("click",$next3SetUp.exitingBucketSave));let i=document.querySelector("button.nx3_disabled_public_access");i&&(i.removeEventListener("click",$next3SetUp.publicBucketSave),i.addEventListener("click",$next3SetUp.publicBucketSave));let n=document.querySelector("button.nx3_remove_all_files");n&&(n.removeEventListener("click",$next3SetUp.removeFilesBucket),n.addEventListener("click",$next3SetUp.removeFilesBucket));let a=document.querySelector("a.nx-change-bucket");a&&a.addEventListener("click",function(e){e.preventDefault();let t=document.querySelector(".nx_bucket_data_views, .nx_aws_region_buuny"),i=document.querySelector(".nx3_exiting_bucket_input");t&&t.classList.add("hide_tr"),i&&i.classList.remove("hide_tr")});let r=document.querySelector("button.nx3_buccket_new");r&&r.addEventListener("click",function(e){e.preventDefault();let t=document.querySelector("ul.nx_bucket_lists_views"),i=document.querySelector("button.nx3_exiting_bucket_btn"),n=document.querySelector("div.nx_aws_region"),a=document.querySelector(".nx_bucket_data_views"),r=document.querySelector(".nx3_exiting_bucket_input");a&&a.classList.add("hide_tr"),r&&(r.classList.remove("hide_tr"),r.value="",r.setAttribute("placeholder","New bucket name here")),n&&n.classList.remove("hide_tr"),t&&t.classList.add("hide_tr"),i&&(i.setAttribute("data-type","create"),i.innerHTML="Create New bucket")});let s=document.querySelector("button.nx3_buccket_exiting");s&&s.addEventListener("click",function(e){e.preventDefault();let t=document.querySelector("ul.nx_bucket_lists_views"),i=document.querySelector("button.nx3_exiting_bucket_btn"),n=document.querySelector("div.nx_aws_region"),a=document.querySelector(".nx_bucket_data_views"),r=document.querySelector(".nx3_exiting_bucket_input");a&&a.classList.add("hide_tr"),r&&(r.classList.remove("hide_tr"),r.value="",r.setAttribute("placeholder","Bucket name here")),n&&n.classList.add("hide_tr"),t&&t.classList.remove("hide_tr"),i&&(i.setAttribute("data-type","settings"),i.innerHTML="Save Bucket Settings")});let c=document.querySelector("ul.nx_bucket_lists_views");c&&c.querySelectorAll("li").forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-value"),t=document.querySelector(".nx3_exiting_bucket_input");t&&(c.classList.add("hide_tr"),t.value=e,t.setAttribute("placeholder","Existing bucket name here"))})})},actionRadioProviders:function(e){let t=document.querySelectorAll(e);t.length>0&&t.forEach(e=>{let t=e.querySelector(".pro-img"),i=e.querySelector(".pro-img-label > input");e.addEventListener("click",function(){document.querySelectorAll(".next3offload-providers .pro-img").forEach(e=>{e.classList.remove("activediv")}),t.classList.add("activediv"),i.checked=!0;let e=i.getAttribute("data-value");document.querySelectorAll(".next3offload-providers-data .render-filed-data").forEach(e=>{e.classList.remove("activediv")});let n=document.querySelector(".next3offload-providers-data .provider-"+e);n&&n.classList.add("activediv")})}),document.querySelectorAll(".next3offload-types-control").forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-id"),t=this.getAttribute("data-class");document.querySelectorAll(".next3offload-types-body."+t).forEach(e=>{e.classList.remove("nxopend")});let i=document.querySelector('[data-target="'+e+'"]');i&&i.classList.add("nxopend")})})},saveConfig:function(e){e.preventDefault();var t=this,i=t.querySelector("button.next3offload-submit");i.innerHTML='<i class="fa fa-spinner fa-spin"></i> Saving',t.classList.add("next3-loading"),nJs.ajax({action:next3config.ajax_url+"?action=next3offload_config",method:"POST",header:{"X-WP-Nonce":window.next3config.nonce},data:{message:"config data",form_data:nJs.serialize(t)}}).onload=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText),n=e.data.redirect?e.data.redirect:"";i.innerHTML="<i></i> Saved";var a=setInterval(function(){i.innerHTML="<i></i> Next",clearInterval(a),""!=n&&window.location.assign(n)},1500);t.classList.remove("next3-loading")}}},exitingBucketSave:function(e){e.preventDefault();var t=this,i=document.querySelector(".next3offload-config-area"),n=document.querySelector(".nx3_msg_error");n&&(n.innerHTML="");let a=t.getAttribute("data-type");"create"==a?t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Processing':t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Saving',i&&i.classList.add("next3-loading");let r=document.querySelector("input.nx3_exiting_bucket_input"),s=document.querySelector("select.nx3_new_region_input");nJs.ajax({action:next3config.ajax_url+"?action=next3_exitbucket",method:"POST",header:{"X-WP-Nonce":window.next3config.nonce},data:{message:"existing bucket set",bucket_name:r?r.value:"",bucket_type:t?t.getAttribute("data-type"):"settings",region:s?s.value:""}}).onload=function(){if(4==this.readyState&&200==this.status){i&&i.classList.remove("next3-loading");let e=JSON.parse(this.responseText);if(!e.success){"create"==a?t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Create New Bucket':t.innerHTML="<i></i> Save Bucket Settings",n.innerHTML=e.data.messege;return}let r=e.data.redirect?e.data.redirect:"";"create"==a?t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Created New Bucket':t.innerHTML="<i></i> Saved Bucket Settings",n.innerHTML=e.data.messege;var s=setInterval(function(){"create"==a?t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Create New Bucket':t.innerHTML="<i></i> Save Bucket Settings",clearInterval(s),""!=r?window.location.assign(r):window.location.reload()},1500)}}},publicBucketSave:function(e){e.preventDefault();var t=this,i=document.querySelector(".next3offload-config-area"),n=document.querySelector(".nx3_msg_error");n&&(n.innerHTML=""),t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Processing "Block All Access"',i&&i.classList.add("next3-loading");let a=document.querySelector("input.nx3_exiting_bucket_input");nJs.ajax({action:next3config.ajax_url+"?action=next3_publicbucket",method:"POST",header:{"X-WP-Nonce":window.next3config.nonce},data:{message:"public request",bucket_name:a?a.value:""}}).onload=function(){if(4==this.readyState&&200==this.status){i&&i.classList.remove("next3-loading");let e=JSON.parse(this.responseText);if(!e.success){t.innerHTML='<i></i> Disable "Block All Public Access"',n.innerHTML=e.data.messege;return}let a=e.data.redirect?e.data.redirect:"";t.innerHTML='<i></i> Disabled "Block All Public Access"',n.innerHTML=e.data.messege;var r=setInterval(function(){clearInterval(r),""!=a&&window.location.assign(a)},1500)}}},removeFilesBucket:function(e){e.preventDefault();var t=this;if(!confirm("Are you sure? Remove all files from Your Buckets"))return;var i=document.querySelector(".next3offload-config-area"),n=document.querySelector(".nx3_msg_error");n&&(n.innerHTML=""),t.innerHTML='<i class="fa fa-spinner fa-spin"></i> Processing "Remove all files"',i&&i.classList.add("next3-loading");let a=document.querySelector("input.nx3_exiting_bucket_input");nJs.ajax({action:next3config.ajax_url+"?action=next3_bucketremove_files",method:"POST",header:{"X-WP-Nonce":window.next3config.nonce},data:{message:"delete all files",bucket_name:a?a.value:""}}).onload=function(){if(4==this.readyState&&200==this.status){i&&i.classList.remove("next3-loading");let e=JSON.parse(this.responseText);if(!e.success){t.innerHTML="<i></i> Remove all Files from this Bucket",n.innerHTML=e.data.messege;return}let a=e.data.redirect?e.data.redirect:"";t.innerHTML='<i></i> Success! "Remove all files"',n.innerHTML=e.data.messege;var r=setInterval(function(){clearInterval(r),""!=a&&window.location.assign(a)},1500)}}}};$next3SetUp.init();