"use strict";
!function(e,t){var n=wp.media,i=n.view.Attachment.Details.TwoColumn;n.view.Attachment.Details.TwoColumn=i.extend({events:function(){this.render_media(this.model.get("id"))},render_media:function(e){0!=e&&""!=e&&this.fetchS3DetailsFile(e)},fetchS3DetailsFile:function(e){wp.ajax.send("next3_get_attachment_provider_details",{data:{_nonce:next3_media.nonces.get_attachment,id:e}}).done(t.bind(this.renderViewFlie,this))},renderViewFlie:function(e){this.renderS3DetailsFile(e)},renderActionLinksFile:function(n){var i=n&&n.links||[],a=this.$el.find(".actions"),o=e("<div />",{class:"s3-actions"}),r=[];t(i).each(function(e){r.push(e)}),o.append(r.join(" | ")),a.append(o)},renderS3DetailsFile:function(e){if(e&&e.provider_object){var t=this.$el.find(".attachment-info .details"),n=this.generateDetailsFile(e,["provider_name","region","bucket","key","url","acl","is_verified"]);t.append(n)}},generateDetailsFile:function(e,n){var i="",a=t.template('<div class="<%= key %>"><strong><%= label %>:</strong> <%= value %></div>');return t(n).each(function(n){if(e.provider_object[n]){var o=e.provider_object[n];if("acl"===n&&(o=e.provider_object[n].name,e.acl_toggle)&&(o=t.template('<a href="#" id="next3-toggle-acl" title="<%= title %>" data-currentACL="<%= acl %>"><%= value %></a>')({title:e.provider_object[n].title,acl:e.provider_object[n].acl,value:o})),"is_verified"===n){if(o=Boolean(parseInt(o)))return;o=next3_media.strings.not_verified}i+=a({key:n,label:next3_media.strings[n],value:o})}}),i}})}(jQuery,_);let $next3Media={inc:0,total_inc:0,init:function(){this.uploadAction(),this.oneByOneAction()},uploadAction:function(){let e=document.querySelector(".post-type-attachment .tablenav .alignleft");e&&(!0==window.next3_media.offload_status&&(nJs.el(e,"button",{class:"button action next3upload-action",type:"button",innerHTML:"Offload files to Cloud (bucket) <span></span>",data_type:"copy",style:"margin: 0 8px 0 0;",trigger:{click:$next3Media.UploaderRequest}}),nJs.el(e,"button",{class:"button action next3upload-action",type:"button",innerHTML:"Move files to WP Media <span></span>",data_type:"move",style:"margin: 0 8px 0 0;",trigger:{click:$next3Media.UploaderRequest}})),!0==window.next3_media.compress_status&&(nJs.el(e,"button",{class:"button action next3upload-action",type:"button",innerHTML:"Start compress <span></span>",data_type:"compress",style:"margin: 0 8px 0 0;",trigger:{click:$next3Media.UploaderRequest}}),nJs.el(e,"button",{class:"button action next3upload-action",type:"button",innerHTML:"Convert WebP <span></span>",data_type:"webp",style:"margin: 0 8px 0 0;",trigger:{click:$next3Media.UploaderRequest}})))},UploaderRequest:function(e){e.preventDefault();let t=this.getAttribute("data-type"),n="offload to cloud.";if("move"==t?n="move to WP media.":"compress"==t?n="compress.":"webp"==t&&(n="convert WebP."),!confirm("Are you sure? selected files want to "+n))return;let i=this.querySelector("span"),a=document.getElementsByName("media[]");for(var o=[],r=0;r<a.length;r++)if(a[r].checked){let l=a[r].value;o.push(l);let s=document.querySelector("tr#post-"+l);s&&s.setAttribute("style","opacity: 0.4; user-select: none;pointer-events: none;")}o.length>0?(i&&($next3Media.inc=0,$next3Media.total_inc=Number(o.length),i.innerHTML=$next3Media.inc+"/"+$next3Media.total_inc),$next3Media.UploaderRequestAction(o,t)):alert("Please select files.")},UploaderRequestAction:function(e,t){if(0==e.length)return;let n=e[0];e.shift();let i=document.querySelector("input#cb-select-"+n);i&&(i.checked=!1);let a=document.querySelector("tr#post-"+n+" > td.column-provider"),o=document.querySelector("tr#post-"+n);o&&o.setAttribute("style","opacity: 0.8; user-select: none;pointer-events: none;background-color: #e6cbc2;"),nJs.ajax({action:window.next3_media.ajax_url+"?action=next3copy_move",method:"POST",header:{"X-WP-Nonce":window.next3_media.nonce},data:{message:"copy file or move file",form_id:n,form_type:t}}).onload=function(){if(4==this.readyState&&200==this.status){let n=JSON.parse(this.responseText);o&&o.removeAttribute("style"),a&&(a.innerHTML=n.data.messege?n.data.messege:"");let i=document.querySelector('button[data-type="'+t+'"] > span');i&&($next3Media.inc=Number($next3Media.inc)+1,i.innerHTML=$next3Media.inc+"/"+$next3Media.total_inc),$next3Media.UploaderRequestAction(e,t)}}},oneByOneAction:function(){let e=document.querySelectorAll(".post-type-attachment table.media span.next3-copy, .post-type-attachment table.media span.next3-compress, .post-type-attachment table.media span.next3-webp");e.length>0&&e.forEach(e=>{let t=e.querySelector(".next3-attachment-copy");t&&t.addEventListener("click",$next3Media.CopyToCloud)})},CopyToCloud:function(e){e.preventDefault();let t=this,n=t.getAttribute("data-id"),i=t.getAttribute("data-type"),a=document.querySelector("tr#post-"+n);a&&a.setAttribute("style","opacity: 0.4; user-select: none;pointer-events: none;");let o=document.querySelector("tr#post-"+n+" > td.column-provider");nJs.ajax({action:window.next3_media.ajax_url+"?action=next3copy_move",method:"POST",header:{"X-WP-Nonce":window.next3_media.nonce},data:{message:"copy file or move file",form_id:n,form_type:i}}).onload=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);a&&a.removeAttribute("style"),e.success&&("copy"==i?(t.setAttribute("data-type","move"),t.innerHTML="Move file to WP Media"):"move"==i&&(t.setAttribute("data-type","copy"),t.innerHTML="Offload file to Cloud")),o&&(o.innerHTML=e.data.messege?e.data.messege:"")}}}};$next3Media.init();